generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model GameSettings {
  id                  String   @id @default("singleton")
  taxRate             Float
  insuranceRate       Float
  interestRate        Float
  salaryAutoSafeRate  Float
  turnDuration        Int
  turn                Int      @default(1)
  isDay               Boolean  @default(true)
  isTimerRunning      Boolean  @default(true)
  lastTick            BigInt
  timeRemaining       Int
  marketStatus        String   @default("open")
  season              String   @default("spring")
  eventRevision       Int      @default(0)
  economyStatus       String   @default("normal")
  economyInterestRate Float    @default(5.0)
  priceIndex          Float    @default(100.0)
  marketTrend         String   @default("stable")
  taxRateAdjust       Float    @default(0.0)
  lastUpdateTurn      Int      @default(0)
  envWeather          String   @default("sunny")
  envTemperature      Int      @default(20)
  envSeason           String   @default("spring")
  infraPower          Int      @default(100)
  infraWater          Int      @default(100)
  infraNetwork        Int      @default(100)
  securityLevel       Int      @default(100)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  moneyMultiplier     Float    @default(1.0)
  isGameStarted       Boolean  @default(false)
  economyTotalSales   Float    @default(0.0)
}

model User {
  id                  String           @id
  name                String
  role                String
  balance             Float
  deposit             Float
  debt                Float
  popularity          Int
  happiness           Int
  rating              Int
  job                 String
  jobType             String?
  lastJobChangeTurn   Int?
  unpaidTax           Float?
  arrestCount         Int?
  stolenAmount        Float?
  fanCount            Int?
  employmentStatus    String
  jobTitle            String?
  currentJobId        String?
  shopName            String?
  cardType            String?
  isInsured           Boolean?
  propertyLevel       String?
  health              Int?
  landRank            Int?
  commuteMethod       String?
  hasLicense          Boolean?
  homeLocationId      String?
  workLocationId      String?
  commuteDistance     Float?
  lastCommuteTurn     Int?
  carFuel             Float?
  isLate              Boolean?
  monthlyParkingCost  Float?
  region              String?
  creditScore         Int?
  isHospitalized      Boolean?
  suspicionScore      Int?
  playerIcon          String?
  traits              Json?
  skills              Json?
  needsTraitSelection Boolean          @default(false)
  timeEra             String?
  stocks              Json?
  forbiddenStocks     Json?
  isForbiddenUnlocked Boolean          @default(false)
  inventory           Json?
  shopItems           Json?
  shopMenu            Json?
  pointCards          Json?
  catalogPoints       Int?
  loyaltyPoints       Int?
  ingredients         Json?
  collection          Json?
  furniture           Json?
  pets                Json?
  coupons             Json?
  gachaCollection     Json?
  shopWebsite         Json?
  pointExchangeItems  Json?
  ownedLands          Json?
  ownedPlaces         Json?
  mainPlaceId         String?
  sidePlaceIds        Json?
  ownedVehicles       Json?
  qualifications      Json?
  examHistory         Json?
  loans               Json?
  insurances          Json?
  lifeStats           Json?
  family              Json?
  partners            Json?
  smartphone          Json?
  commuteInfo         Json?
  auditLogs           Json?
  jobHistory          Json?
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  cryptoHoldings      Json?
  isOff               Boolean          @default(false)
  vacationReason      String?
  isDebugAuthorized   Boolean          @default(false)
  proposals           PolicyProposal[]
  requests            Request[]
  transactions        Transaction[]
  votes               Vote[]
  receivedMessages    Message[]        @relation("ReceivedMessages")
  sentMessages        Message[]        @relation("SentMessages")
  createdParcels      Parcel[]         @relation("ParcelCreatedBy")
  ownedParcel         Parcel?          @relation("ParcelOwner")
  callsMade           VoiceCall[]      @relation("CallsMade")
  callsReceived       VoiceCall[]      @relation("CallsReceived")
}

model Stock {
  id            String   @id
  name          String
  price         Float
  previousPrice Float
  volatility    Float
  isForbidden   Boolean
  priceHistory  Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Crypto {
  id            String   @id @default(uuid())
  name          String
  symbol        String
  price         Float
  previousPrice Float
  volatility    Float
  priceHistory  Json?
  creatorId     String
  description   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Request {
  id             String   @id
  type           String
  requesterId    String
  amount         Float
  details        String?
  status         String
  timestamp      BigInt
  idempotencyKey String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [requesterId], references: [id])

  @@index([requesterId])
  @@index([status])
}

model Transaction {
  id          String   @id
  type        String
  amount      Float
  senderId    String?
  receiverId  String?
  description String
  timestamp   BigInt
  createdAt   DateTime @default(now())
  user        User?    @relation(fields: [receiverId], references: [id])

  @@index([receiverId])
  @@index([senderId])
}

model Product {
  id          String  @id
  sellerId    String
  name        String
  price       Float
  isSold      Boolean
  description String?
  condition   String?
  comment     String?
  imageUrl    String?
  createdAt   BigInt?
  soldAt      BigInt?
  buyerId     String?

  @@index([sellerId])
  @@index([isSold])
}

model Land {
  id                String   @id
  lat               Float
  lng               Float
  address           String
  price             Float
  ownerId           String?
  type              String?
  size              Float
  zoning            String
  status            String   @default("active")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  allowCompany      Boolean  @default(true)
  allowConstruction Boolean  @default(true)
  isForSale         Boolean  @default(true)
  maintenanceFee    Float    @default(0)
  polygon           Json?
  requiresApproval  Boolean  @default(false)

  @@index([ownerId])
}

model Place {
  id         String   @id
  ownerId    String
  name       String
  type       String
  status     String
  level      Int
  lat        Float
  lng        Float
  address    String
  landId     String
  stats      Json?
  employees  Json?
  licenses   Json?
  insurances Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([ownerId])
}

model NPC {
  id            String   @id
  targetUserId  String
  templateId    String
  type          String
  name          String
  description   String
  entryTime     BigInt
  leaveTime     BigInt
  effectApplied Boolean
  createdAt     DateTime @default(now())

  @@index([targetUserId])
}

model NPCTemplate {
  id             String   @id
  name           String
  description    String
  duration       Int
  spawnRate      Int
  actionType     String
  minPayment     Int?
  maxPayment     Int?
  minStealItems  Int?
  maxStealItems  Int?
  minStealAmount Int?
  maxStealAmount Int?
  createdAt      DateTime @default(now())
}

model GameEvent {
  id           String   @id
  name         String
  description  String
  type         String
  startTime    BigInt
  duration     Int
  effectValue  Float
  targetUserId String?
  createdAt    DateTime @default(now())

  @@index([targetUserId])
}

model Property {
  id          String   @id
  name        String
  type        String
  price       Float
  income      Float
  ownerId     String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([ownerId])
}

model News {
  id        String   @id
  message   String
  timestamp BigInt
  createdAt DateTime @default(now())
}

model RouletteResult {
  id           String   @id @default("singleton")
  text         String
  timestamp    BigInt
  targetUserId String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model IdempotencyKey {
  key       String   @id
  createdAt DateTime @default(now())

  @@index([createdAt])
}

model CatalogItem {
  id             String   @id
  name           String
  category       String
  emoji          String
  wholesalePrice Float
  stock          Int
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Parcel {
  id                String       @id @default(uuid())
  addressNormalized String
  lat               Float
  lng               Float
  price             Int
  status            ParcelStatus @default(DRAFT)
  createdByUserId   String?
  ownerUserId       String?      @unique
  soldAt            DateTime?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  createdBy         User?        @relation("ParcelCreatedBy", fields: [createdByUserId], references: [id])
  owner             User?        @relation("ParcelOwner", fields: [ownerUserId], references: [id])

  @@map("parcels")
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  imageUrl   String?
  type       String?
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])

  @@index([receiverId, isRead])
  @@index([senderId])
  @@map("messages")
}

model VoiceCall {
  id         String     @id @default(uuid())
  callerId   String
  receiverId String
  status     CallStatus @default(PENDING)
  startedAt  DateTime   @default(now())
  endedAt    DateTime?
  duration   Int?
  caller     User       @relation("CallsMade", fields: [callerId], references: [id])
  receiver   User       @relation("CallsReceived", fields: [receiverId], references: [id])

  @@index([callerId])
  @@index([receiverId])
  @@map("voice_calls")
}

model PolicyProposal {
  id          String   @id @default(uuid())
  title       String
  description String
  type        String
  params      Json?
  proposerId  String
  status      String   @default("active")
  deadline    BigInt
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  proposer    User     @relation(fields: [proposerId], references: [id])
  votes       Vote[]

  @@index([status])
}

model Vote {
  id         String         @id @default(uuid())
  proposalId String
  userId     String
  vote       String
  createdAt  DateTime       @default(now())
  proposal   PolicyProposal @relation(fields: [proposalId], references: [id])
  user       User           @relation(fields: [userId], references: [id])

  @@unique([proposalId, userId])
}

model BankerElection {
  id          String   @id @default(uuid())
  status      String   @default("active")
  startedAt   DateTime @default(now())
  endsAt      DateTime
  candidates  Json
  votes       Json?
  npcVotes    Json?
  winnerId    String?
  rewardLog   Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
}

enum ParcelStatus {
  DRAFT
  PUBLISHED
  SOLD
  HIDDEN
}

enum CallStatus {
  PENDING
  ACTIVE
  ENDED
  MISSED
  DECLINED
}

model Video {
  id             String   @id @default(uuid())
  uploaderId     String
  uploaderName   String
  title          String
  description    String?
  tags           Json?
  url            String
  thumbnailColor String?
  views          Int      @default(0)
  likes          Int      @default(0)
  likedBy        Json?
  subscribers    Int      @default(0)
  timestamp      BigInt
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([uploaderId])
}

